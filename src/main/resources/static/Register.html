<!DOCTYPE html>
<html>

<head>
  
  <link rel="stylesheet" href="css/Register.css">
  <style>
    img {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
  <img src="Cryptus finale logo.png" alt="Cryptus for all " style="width:140px;height:180px;">
  <h1 style="text-align:center">Cryptus</h1>




  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <style>

      .error {
          background-color: red;
      }

  </style>





  





  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Datepicker - Default functionality</title>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>













  
</head>



<body>
  <script>
    $( function() {
      $( "#datepicker" ).datepicker();
    } );
    </script>

<script>


function elfProefValidation(BSN) {
  document.querySelector('#bsn').addEventListener('focusout', checkForAddressPart(BSN));
        let returnValue = false;
      
        if (BSN === '00000000000' || value.length !== 9) {
            return false;
        }
        const values = BSN.split('');
        const lastCharacter = parseInt(values[values.length - 1], 10);
        const [a, b, c, d, e, f, g, h, i] = values.map((char) => parseInt(char, 10));
        let result = 0;

        if (BSN !== '00000000000' || value.length == 9) {
            result = 9 * a + 8 * b + 7 * c + 6 * d + 5 * e + 4 * f + 3 * g + 2 * h + -1 * i;
            returnValue = result > 0 && result % 11 === 0;
        // } else if (type === 'own') {
        //     result = 9 * a + 8 * b + 7 * c + 6 * d + 5 * e + 4 * f + 3 * g + 2 * h;
        //     returnValue = result > 0 && result % 11 === lastCharacter + 5;
        } else {
            returnValue = false;
            alert("Please enter a valid BSN.");
        }

        return returnValue;
    }

</script>
























  <script type="module">
    function login() {

    }
    //Reset Inputfield code.
    function clearFunc() {
      document.getElementById("gebruikersnaam").value = "";
      document.getElementById("wachtwoord").value = "";
    }

  </script>
  




  <!-- Main div code -->
  <div id="main">
    <div class="h-tag">
    </div>
    <!-- Login box -->
    <div class="Register">
      <table cellspacing="2" align="center" cellpadding="8" border="0">
        <tr>
          <td>Enter first name :</td>
          <td><input type="text" placeholder="Enter first name here" id="firstName" class="tb" /></td>
        </tr>
        <tr>
            <td>Enter proposition :</td>
            <td><input type="text" placeholder="Enter proposition here" id="proposition" class="tb" /></td>
          </tr>
          <tr>
            <td>Enter last name :</td>
            <td><input type="text" placeholder="Enter last name here" id="lastName" class="tb" /></td>
          </tr>
          <tr>
            <td>Enter User Name :</td>
            <td><input type="text" placeholder="Enter user name here" id="email" class="tb" /></td>
          </tr>
        
        <tr>
          <td>Enter Password :</td>
          <td><input type="password" placeholder="Enter Password here" id="pwd1" class="tb" /></td>
        </tr>
        <tr>
            <td>Enter date of birth :</td>
            <td><input type="text" placeholder="22/22/2222" id="datepicker" class="tb" /></td>
          </tr>
          <tr>
            <td>Enter house number :</td>
            <td><input type="number" placeholder="100" id="houseNumber" class="tb" /></td>
          </tr>
          <tr>
            <td>Enter post code :</td>
            <td><input type="text" placeholder="1000NL" id="postCode" class="tb" /></td>
          </tr>
          <tr>
            <td>Enter street Name :</td>
            <td><input type="text" placeholder="Enter street name here" id="street" class="tb" /></td>
          </tr>
          
          <tr>
            <td>Enter city :</td>
            <td><input type="text" placeholder="Enter city name here" id="city" class="tb" /></td>
          </tr>
          <tr>
            <td>Enter BSN :</td>
            <td><input type="text" placeholder="999999990" id="bsn" class="tb" /></td>
          </tr>
          <tr>
            <td>Enter email :</td>
            <td><input type="text" placeholder="Enter email here" id="email1" class="tb" /></td>
          </tr>
        <tr>
          
          <td>
        
            <input type="submit"  id="btnLogin" value="Send" class="btn" />  
            
            

            <!-- <a href="Haircut.html"> <input type="submit" value="Register"   ></a> -->

          </td>
          
        </tr>
      </table>
      

      




      <div id="error" hidden>
        <p>postcode, house number combination is unknown</p>
    </div>
    
    <script>
        
        document.querySelector('#postCode').addEventListener('focusout', checkForAddressPart);
    
        document.querySelector('#houseNumber').addEventListener('focusout', checkForAddressPart);





        




    
        function checkForAddressPart(){
            let regex = new RegExp(/^[1-9][0-9]{3}[\s]?[A-Za-z]{2}$/i);
    
            // velden moeten niet leg zijn, liefst regex
            let postcode = document.querySelector('#postCode').value
            let houseNumber = document.querySelector('#houseNumber').value
    
            // als postcode een valide postcode is nummer niet leeg, dan
            console.log('pc is valide: ' + regex.test(postcode))
    
            if(regex.test(postcode) && houseNumber){
                // var data = { postcode: postcode, nr: huisnummer};
                // stuur data als form data ipv json, want backend accepteert alleen form
                let formData = `postcode=${postcode}&number=${houseNumber}` //postcode=1234AB&nr=15
    
                fetch("https://postcode.tech/api/v1/postcode?" + formData , {
                    headers: {
                        'Authorization': 'Bearer 1d3dc31e-842e-4d3d-b2c8-bcd127cb0232',
                    },
                })
                    .then(response => response.json())
                    .then(json => processAddress(json))
                    .catch((error) => { console.error('Foutje', error) });
    
            }
    
        }
        function processAddress(data){
            document.querySelector('#error').style.display = 'none';
            // haal de data uit de request
            let addressPart = data; // de data is in ASCII format, nu nog naar object omzetten
            // velden vullen
            document.querySelector('#city').value = addressPart.city; // zonder validatie
            document.querySelector('#street').value = addressPart.street; // zonder validatie
            // error style weghalen
            document.querySelector('#postCode').classList.remove('error');
            document.querySelector('#houseNumber').classList.remove('error');
        }
    
    </script>





    </div>
    <!-- login box div ending here.. -->
  </div>
  <!-- Main div ending here... -->

  <script>
    function register() {
      window.location.href = "Haircut.html"

    }

    function containsAnyLetter(str) {
  return /[a-zA-Z]/.test(str);
}

  function underAgeValidate(birthday){
	// it will accept two types of format yyyy-mm-dd and yyyy/mm/dd
	var optimizedBirthday = birthday.replace(/-/g, "/");

	//set date based on birthday at 01:00:00 hours GMT+0100 (CET)
	var myBirthday = new Date(optimizedBirthday);

	// set current day on 01:00:00 hours GMT+0100 (CET)
	var currentDate = new Date().toJSON().slice(0,10)+' 01:00:00';

	// calculate age comparing current date and borthday
	var myAge = ~~((Date.now(currentDate) - myBirthday) / (31557600000));

	if(myAge < 18) {
     	    // return false;
           //alert("You need to be at least 18 years old");
           
        }else{
	    return true;
	}

} 


function isOverEighteen(day, month, year) {
  var now = parseInt(new Date().toISOString().slice(0, 10).replace(/-/g, ''));
  var dob = day * 1 + month * 100 + year * 10000; // Coerces strings to integers

  return now - dob > 180000;
}


  </script>
  

  <script>

    document.querySelector('#btnLogin').addEventListener('click', (e) => {
      var uname = document.getElementById("email").value;
      var pwd = document.getElementById("pwd1").value;
      var firstName = document.getElementById("firstName").value;
      var proposition = document.getElementById("proposition").value;
      var lastName = document.getElementById("lastName").value;
      var dOB = document.getElementById("datepicker").value;
      var houseNumber = document.getElementById("houseNumber").value;
      var postCode = document.getElementById("postCode").value;
      var street = document.getElementById("street").value;
      var city = document.getElementById("city").value;
      var BSN = document.getElementById("bsn").value ;
      var email = document.getElementById("email1").value;
      var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;



      if (firstName == ''  ) {
        alert("please enter first name.");
      }

      //|| lastName == ''|| dOB == '' || houseNumber == '' || postCode == '' || street == '' || city == '' || BSN == ''
      else if (lastName == '') {
        alert("please enter last name.");
      }
      else if (uname == '') {
        alert("please enter user name.");
      }
      else if (!filter.test(uname)) {
        alert("please Enter a valid email.");
      }
      else if (pwd == '') {
        alert("please enter the password");
      }
      else if (pwd.length < 6 || pwd.length > 25) {
        alert("Password min length is 6 and max length is 15.");
      }
     
      else if (dOB == '') {
        alert("please enter date of birth");
      }


      else if(underAgeValidate(dOB)){
        alert("You need to be at least 18 years old");

      }


      else if (houseNumber == '') {
        alert("please enter house number.");
      }
      else if (postCode == '') {
        alert("please postcode.");
      }
      else if (street == '') {
        alert("please enter street name.");
      }
      else if (city == '') {
        alert("please enter city name.");
      }
      else if (BSN == '') {
        alert("please enter BSN name.");
      }


      
      
      else if (BSN === '00000000000' || BSN.length !== 9) {
        alert("Please enter a valid BSN.");
        }

   

      else  if (BSN !== '00000000000' || BSN.length == 9) {

          const values = BSN.split('');
        const lastCharacter = parseInt(values[values.length - 1], 10);
        const [a, b, c, d, e, f, g, h, i] = values.map((char) => parseInt(char, 10));
        let result = 0;




            result = 9 * a + 8 * b + 7 * c + 6 * d + 5 * e + 4 * f + 3 * g + 2 * h + -1 * i;
            returnValue = result > 0 && result % 11 === 0;

             if (containsAnyLetter(BSN)){
              alert("Please enter a valid BSN.");

            }
        // } else if (type === 'own') {
        //     result = 9 * a + 8 * b + 7 * c + 6 * d + 5 * e + 4 * f + 3 * g + 2 * h;
        //     returnValue = result > 0 && result % 11 === lastCharacter + 5;
        } 

     














      else if (email == '') {
        alert("please enter your email.");
      }
      else if (!filter.test(email)) {
        alert("please enter a valid email.");
      }
    

     
      
      else {
        // fetch 
      //   let userName = document.querySelector('#gebruikersnaam').value
      // let password = document.querySelector('#wachtwoord').value

      // JS Object -> to a string version
      let data = {
        voornaam: firstName,
        tussenvoegsel: proposition,
        achternaam: lastName,
        gebruikersnaam: uname,
        wachtwoord: pwd,
        geboortedatum: dOB,
        straat: street,
        huisnummer:houseNumber,
        postcode: postCode,
        woonplaats: street,
        bsn: BSN,
        emailadres: email 




      }

      //let token = localStorage.setItem ('token',json.waarde) for a token
      fetch('http://localhost:8080/klant/create',
        {
          method: 'POST',
          headers: {
            'content-Type': 'application/json',
            //'Authorization': 'Bearer ${token}'

          },
          body: JSON.stringify(data)

        })

        .then((response) => { // callback
          console.log(response)
          if (response.status === 201) {
            return response.json()

          }


        }).then(json => {
          if(json === undefined) {
            console.log('Not registered')
          }else {
            console.log(json)
            // select element uit de DOM
            // const p = document.querySelector('#antwoord')

            // p.innerHTML = json.waarde
            alert('Thank You for Registering & You are Redirecting to Cryptus login page');


            window.location.href = "Haircut.html" // redirect after loggin in
          }


          //localStorage.setItem ('token',json.waarde) for a token
        })
        
      }

      
    })




    console.log('Voor de request')




    console.log('Na request')



  </script>

  

  





</body>



</html>