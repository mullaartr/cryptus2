<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="css/indexccss.css">

  <style>
    img {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
  <img src="images/Cryptus%20finale%20logo.png" alt="Cryptus for all " style="width:140px;height:180px;">
  <h1 style="text-align:center">Cryptus</h1>
</head>

<body>


<script type="module">
  function login() {

  }
  //Reset Inputfield code.
  function clearFunc() {
    document.getElementById("gebruikersnaam").value = "";
    document.getElementById("wachtwoord").value = "";
  }

</script>




<!-- Main div code -->
<div id="main">
  <div class="h-tag">
  </div>
  <!-- Login box -->
  <div class="login">
    <table cellspacing="2" align="center" cellpadding="8" border="0">
      <tr>
        <td>Enter Email address:</td>
        <td><input type="text" placeholder="Enter email address here" id="email" class="tb" /></td>
      </tr>
      <tr>
        <td>Enter Password :</td>
        <td><input type="password" placeholder="Enter Password here" id="pwd1" class="tb" /></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <input type="submit" value="Reset" onclick="clearFunc()" class="btn" />
          <input type="submit" id="btnLogin" value="Login" class="btn" />
          <input type="submit" value="Register" class="btn" onclick="register()" />

          <!-- <a href="Haircut.html"> <input type="submit" value="Register"   ></a> -->

        </td>
      </tr>
    </table>
  </div>
  <!-- login box div ending here.. -->
</div>
<!-- Main div ending here... -->

<script>
  function register() {
    window.location.href = "Register.html"

  }


</script>

<script>

  document.querySelector('#btnLogin').addEventListener('click', (e) => {
    var uname = document.getElementById("email").value;
    var pwd = document.getElementById("pwd1").value;
    var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (uname == '') {
      alert("please enter user name.");
    }
    else if (pwd == '') {
      alert("enter the password");
    }
    else if (!filter.test(uname)) {
      alert("Enter valid email id.");
    }
    else if (pwd.length < 6 || pwd.length > 25) {
      alert("Password min length is 6 and max length is 15.");
    }

    else {

      // fetch
      //   let userName = document.querySelector('#gebruikersnaam').value
      // let password = document.querySelector('#wachtwoord').value

      // JS Object -> to a string version
      let data = {
        username: uname,
        password: pwd

      }

      console.log( data );

      //var bearer = 'Bearer ' + bearer_token;

      fetch('http://localhost:8080/login',
              {
                method: 'POST',
                headers: {
                 // 'Authorization': bearer,
                  'content-Type': 'application/json'
                  //'Authorization': 'Bearer ${token}'

                },
                body: JSON.stringify(data)
              })

              .then(response => { // callback
                console.log(response)
                if (response.status === 200) {
                  let token = response.headers.get("Authorization").split(" ")[1]
                  console.log(token)
                  return token

                }


              }
              ).then(json => {

        if(json === undefined) {
          console.log('not logged in')
          alert('Wrong password username combination');
        }else {
          console.log(json)
          // select element uit de DOM
          // const p = document.querySelector('#antwoord')

          localStorage.setItem ('token', json)

          // p.innerHTML = json.waarde
          alert('Thank You for Login & You are Redirecting to Cryptus Website');



          window.location.href = "WelkomsPagina.html" // redirect after loggin in
        }



      })

    }


  })




  console.log('Voor de request')




  console.log('Na request')



</script>


</body>

</html>