<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/BaseTemplate.css">
    <script src="js/BaseTemplate.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TweenMax.min.js"
            integrity="sha512-DkPsH9LzNzZaZjCszwKrooKwgjArJDiEjA5tTgr3YX4E6TYv93ICS8T41yFHJnnSmGpnf0Mvb5NhScYbwvhn2w=="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.3/TimelineMax.min.js"
            integrity="sha512-0xrMWUXzEAc+VY7k48pWd5YT6ig03p4KARKxs4Bqxb9atrcn2fV41fWs+YXTKb8lD2sbPAmZMjKENiyzM/Gagw=="
            crossorigin="anonymous"></script>


    <style>
        col:nth-child(2n +1) {
            background: #FFF
        }
        /* heb ik dit nodig? */
    </style>
</head>

<body>
<div class="wrapper">
    <div class="header"><img src="Assets/Cryptus finale logo.png" id="cryptusLogo" width="150px">
        <h2 class="item0">"Bless the Bytes"</h2>
    </div>
    <div class="tickerwrapper">
        <ul class='list'>
            <li class='listitem' id="Bitcoin"></li>
            <li class='listitem' id="Ethereum"></li>
            <li class='listitem' id="Tether"></li>
            <li class='listitem' id="USD-Coin"></li>
            <li class='listitem' id="BinanceCoin"></li>
            <li class='listitem' id="Cardano"></li>
            <li class='listitem' id="Ripple"></li>
            <li class='listitem' id="Binance-USD"></li>
            <li class='listitem' id="Solana"></li>
            <li class='listitem' id="Dogecoin"></li>
            <li class='listitem' id="Polkadot"></li>
            <li class='listitem' id="Wrapped-Bitcoin"></li>
            <li class='listitem' id="Staked-Ether"></li>
            <li class='listitem' id="Tron"></li>
            <li class='listitem' id="Avalanche-2"></li>
            <li class='listitem' id="Dai"></li>
            <li class='listitem' id="Shiba-Inu"></li>
            <li class='listitem' id="Leo"></li>
            <li class='listitem' id="Cronos"></li>
            <li class='listitem' id="Litecoin"></li>
        </ul>
    </div>

    <div class="main" id="iets"></div>

    <div class="item7">
        <button id="item1" class="buttons" type="button">Hoofdpagina</button>
    </div>

    <div class="voetje"></div>
</div>
</body>
<script>

    document.querySelector('#item1').addEventListener("click", () => {
        window.location.href = "register.html";//andere pagina?
    })

    function maakAssetList() {

        // let assetKoersenString = `
        // [
        // {"assetNaam":"bitcoin","wisselkoersEuro":"29000.000000","wisselkoersDollar":"28000.000000"},
        // {"assetNaam":"Ethereum","wisselkoersEuro":"30000.000000","wisselkoersDollar":"27000.000000"},
        // {"assetNaam":"Tether","wisselkoersEuro":"31000.000000","wisselkoersDollar":"26000.000000"},
        // {"assetNaam":"USD-Coin","wisselkoersEuro":"32000.000000","wisselkoersDollar":"25000.000000"},
        // {"assetNaam":"Dogecoin","wisselkoersEuro":"33000.000000","wisselkoersDollar":"24000.000000"},
        // {"assetNaam":"Solana","wisselkoersEuro":"29000.000000","wisselkoersDollar":"28000.000000"},
        // {"assetNaam":"Litecoin","wisselkoersEuro":"30000.000000","wisselkoersDollar":"27000.000000"},
        // {"assetNaam":"Cronos","wisselkoersEuro":"31000.000000","wisselkoersDollar":"26000.000000"},
        // {"assetNaam":"Shiba-Inu","wisselkoersEuro":"32000.000000","wisselkoersDollar":"25000.000000"},
        // {"assetNaam":"Leo","wisselkoersEuro":"33000.000000","wisselkoersDollar":"24000.000000"},
        // {"assetNaam":"nr11","wisselkoersEuro":"29000.000000","wisselkoersDollar":"28000.000000"},
        // {"assetNaam":"nr12","wisselkoersEuro":"30000.000000","wisselkoersDollar":"27000.000000"},
        // {"assetNaam":"nr13","wisselkoersEuro":"31000.000000","wisselkoersDollar":"26000.000000"},
        // {"assetNaam":"nr14","wisselkoersEuro":"32000.000000","wisselkoersDollar":"25000.000000"},
        // {"assetNaam":"nr15","wisselkoersEuro":"33000.000000","wisselkoersDollar":"24000.000000"},
        // {"assetNaam":"nr16","wisselkoersEuro":"29000.000000","wisselkoersDollar":"28000.000000"},
        // {"assetNaam":"nr17","wisselkoersEuro":"30000.000000","wisselkoersDollar":"27000.000000"},
        // {"assetNaam":"nr18","wisselkoersEuro":"31000.000000","wisselkoersDollar":"26000.000000"},
        // {"assetNaam":"nr19","wisselkoersEuro":"32000.000000","wisselkoersDollar":"25000.000000"},
        // {"assetNaam":"nr20","wisselkoersEuro":"33000.000000","wisselkoersDollar":"24000.000000"}
        // ]
        // `
        // let assetKoersen = JSON.parse(assetKoersenString)

        let assetKoersen = `${json.assetNaam}` //is dit correcte manier om koersen in de function te krijgen?

        const assetTable = document.createElement('table')

        assetKoersen.forEach(e => {
            const row = document.createElement("tr")
            assetTable.appendChild(row)

            const cellAssetNaam = document.createElement("td")
            cellassetNaam.innerHTML = e.assetNaam
            row.appendChild(cellassetNaam)

            const cellWisselkoersEuro = document.createElement("td")
            cellWisselkoersEuro.innerHTML = e.wisselkoersEuro
            row.appendChild(cellWisselkoersEuro)

            const cellWisselkoersDollar = document.createElement("td")
            cellWisselkoersDollar.innerHTML = e.wisselkoersDollar
            row.appendChild(cellWisselkoersDollar)

            const buyButton = document.createElement("button")
            buyButton.classList.add("buttons")
            buyButton.innerHTML = "BUY " + `${e.assetNaam}`
            buyButton.id = `${e.assetNaam}`
            buyButton.addEventListener("click", buyAsset)
            row.appendChild(buyButton)

            const amount = document.createElement("input");
            amount.id = "amountOf" + `${e.assetNaam}`
            amount.setAttribute("type", "text");
            row.appendChild(amount);

        });
        assetTable.setAttribute("border", "0")
        const iets = document.querySelector('#iets')
        iets.appendChild(assetTable)
    }
    maakAssetList();

    function buyAsset() {
        let name = document.querySelector(`#${assetNaam}`)
        let amount = document.querySelector(`#amountOf${assetNaam}`)
        let buyParams = { assetName: `${name}`, assetAmount: `${amount}` }
        let token = localStorage.getItem('token');
        fetch('http://localhost:8080/buytransaction_bank', //ik heb deze POST-request niet in Postman
            {
                method: 'POST',
                headers: {
                    'content-Type': 'application/json' // correct header?
                },
                body: JSON.stringify(buyParams)
                //the POST aan de Java-kant returns null, should that change?
            }).then((response) => {
            if (response.status === 200) {
                return response.json(); //pop up: transactie geslaagd
            } else {
                //pop up: onvoldoende saldo
            }
        }).then(json => {
            return json;
        })
            .catch((error) => {
                console.error('Foutje', error); // pop up: transactie gefaald
            });
    }

    //klantOphaler();

    // koersOphaler();
    // let koersen;
    // let euroOfDollar = true;

    function klantNaamOphaler() {
        let token = localStorage.getItem('token');
        fetch('http://localhost:8080/klant',
            {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }

            }).then((response) => {
                if (response.status === 200) {
                    return response.json();
                }
            }
        ).then(json => {
                return json;
            }
        )
    }

    // hoe dit via template doen als ik maakAssetList(koersen) wil aanroepen in koersOphaler()?
    function koersOphaler() {
        let token = localStorage.getItem('token')

        fetch('http://localhost:8080/koers/meest-recent', //ik heb deze GET-request niet in Postman
            {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            }).then((response) => {
                console.log(response)
                if (response.status === 200) {
                    return response.json();
                }
            }
        ).then(json => {
                koersen = json;
                koersen.forEach(koersen => vullLijstEuro(koersen));
                maakTekstLint()
                maakAssetList(koersen); //is this correct way of calling maakAssetList()???
            }
        ).catch(ex => {
            console.log(ex)
        })
    }
    // function vullLijstEuro(json) {
    //     const naam = `#${json.assetNaam}`;
    //     const e = document.querySelector(naam)
    //     const plaatje = `Assets/${json.assetNaam}.webp`
    //     if (euroOfDollar) {
    //         e.innerHTML = `<img src="${plaatje}" style="margin-top: 2px">" ${json.assetNaam} â‚¬ ${json.koersInEuro}`;
    //     } else {
    //         e.innerHTML = `<img src="${plaatje}" style="margin-top: 2px">" ${json.assetNaam} : $ ${json.koersInDollars}`;
    //     }

    // }
    // document.querySelector('.tickerwrapper').addEventListener("click", () => {
    //     euroOfDollar = !euroOfDollar;
    //     koersen.forEach(koersen => vullLijstEuro(koersen));
    // })

    function klantOphaler() {
        let token = localStorage.getItem('token')
        //let klantnaam = `${klantNaamOphaler()}`
        fetch(`http://localhost:8080/klant/findByUsernamePassword/`,
            {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            }).then((response) => {
                console.log(response)
                if (response.status === 200) {
                    console.log("We zien hier")
                    return response.json();
                }
            }
        ).then(json => {
                const p = document.querySelector(`#iets`);
                p.innerHTML = json.firstName;
            }
        ).catch(ex => {
            console.log(ex)
        })
    }

    // function maakTekstLint() {
    //     var $tickerWrapper = $(".tickerwrapper");
    //     var $list = $tickerWrapper.find("ul.list");
    //     var $clonedList = $list.clone();
    //     var listWidth = 20;

    //     $list.find("li").each(function (i) {
    //         listWidth += $(this, i).outerWidth(true);
    //     });

    //     var endPos = $tickerWrapper.width() - listWidth;

    //     $list.add($clonedList).css({
    //         "width": listWidth + "px"
    //     });

    //     $clonedList.addClass("cloned").appendTo($tickerWrapper);

    //     var infinite = new TimelineMax({ repeat: -1, paused: true });
    //     var time = 40;

    //     infinite.fromTo($list, time, { rotation: 0.01, x: 0 }, { force3D: true, x: -listWidth, ease: Linear.easeNone }, 0)
    //         .fromTo($clonedList, time, { rotation: 0.01, x: listWidth }, { force3D: true, x: 0, ease: Linear.easeNone }, 0)
    //         .set($list, { force3D: true, rotation: 0.01, x: listWidth })
    //         .to($clonedList, time, { force3D: true, rotation: 0.01, x: -listWidth, ease: Linear.easeNone }, time)
    //         .to($list, time, { force3D: true, rotation: 0.01, x: 0, ease: Linear.easeNone }, time)
    //         .progress(1).progress(1)
    //         .play();
    //     $tickerWrapper.on("mouseenter", function () {
    //         infinite.pause();
    //     }).on("mouseleave", function () {
    //         infinite.play();
    //     });
    // }
</script>


</html>